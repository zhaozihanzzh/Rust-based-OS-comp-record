# 4 月 19 日

## 页表和内存管理

今天听了课。

Sv32 地址映射方式：对应 32 位
Sv39 地址映射方式：64 位，VA 按 9 + 9 + 9 + 12 划分

| 31--------20 | 19------10 | 9-8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
| ------------ | ---------- | --- | - | - | - | - | - | - | - | - | 
| PPN[1]       | PPN[0]     | RSW | D | A | G | U | X | W | R | V |

上图是 Sv32 的 Page Table Entry。Sv39 的 9:0 位与该表相同。

- `V`：有效，等于 0 的话剩下的不用看了。
- `R`，`W`，`X`：可读，可写，可执行。全为 0 代表这个是指向下一级页表的指针。
- `U`：用户模式可访问。设定了 ` sstatus` 寄存器中的 `SUM` 位后，Supervisor 可以读写但不能执行，否则不能访问。
- `G`：全局映射
- `A`：Accessed，自从上次该位被清除后被读、写、fetch 过（？）
- `D`： Dirty，自从上次该位被清除后被写过
- `RSW`：保留

S 态引入了 ```satp``` 寄存器，切换页表时修改其中 ```PPN```（Physical Page Number）位域使其指向不同的页表根节点即可。

## 总结

有时间的话看 《RISC-V手册：一本开源指令集的指南》并准备配置实验环境了。最近效率不高，需要加油。