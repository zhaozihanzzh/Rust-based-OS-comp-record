# 4 月 21 日

## RISC-V 汇编指令以及 rCore 中与汇编有关部分的讲解

今天听了课。

### 寄存器

|寄存器|接口名称|描述|
|-----|------|---|
|x0| zero |硬编码 0|
|x1| ra |返回地址|
|x2 | sp |栈指针|
|x10-x11| a0-a1| 函数参数/返回值|

### rCore 链接

链接器要把来自不同目标文件的相同段的数据拼在一起（需要链接脚本确定，linker.ld），且重新定位不同文件的段 -> 拼成一个文件。

链接脚本 ```SECTIONS``` 里星号指的是所有目标文件都进行数据段收集。

Rustsbi 指定起始执行位置 0x80200000。

### rCore 汇编

```.globl``` 将符号对外暴露。（全局符号）

Rust 中 ```#[no_mangle]``` 作用是不作混淆，函数名不变，让汇编和 Rust 看到相同符号。

extern C 里面读出 linker.ld 中的地址，以函数的形式写出（实际上要类型转换成 ```usize```，如 ```fn boot_stack_top();```）。

```.align 2```：指 2^2 对齐（64 位 RISC-V 也是 4 字节的指令长）

cargo 先编译并执行 build.rs，然后再编译主程序。

```.incbin```：按顺序把指定文件的字节拷贝过来，这里是把用户态应用也给打包进 OS 里了。

## 总结

计划看《RISC-V手册：一本开源指令集的指南》，先阅读一下导言了解一下。争取下周开始实验。